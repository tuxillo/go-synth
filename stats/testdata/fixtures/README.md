# BSD Sysctl Test Fixtures

This directory contains binary sysctl test data for testing the stats package
parsing logic on any platform (Linux/macOS/BSD).

## Fixtures

- `vm.loadavg.bin` - Load average data (16 bytes)
- `vm.vmtotal.bin` - VM totals and process counts (46 bytes)
- `vm.swap_info.bin` - Swap device information (48 bytes, 2 devices)
- `*.txt` - Human-readable reference versions
- `system_info.txt` - Metadata and expected values

## Current Fixtures: Synthetic Test Data

The current fixtures are **synthetic** (generated by
`scripts/generate_fixtures.go`) and represent a realistic moderately-loaded
BSD system. They are sufficient for testing parsing logic and are
immediately usable on any platform.

To regenerate synthetic fixtures:

```bash
go run scripts/generate_fixtures.go
```

## Capturing Real VM Data (Optional)

To replace synthetic fixtures with real VM data:

```bash
# 1. Sync project to VM
make vm-sync

# 2. SSH into VM
make vm-ssh

# 3. Run capture script
cd /root/go-synth
./scripts/capture-bsd-fixtures.sh

# 4. Exit VM and sync back
exit
make vm-sync-back  # or manually scp files back
```

## Using Fixtures in Tests

Tests can load fixtures using:

```go
func TestParseLoadavg(t *testing.T) {
    data, err := os.ReadFile("testdata/fixtures/vm.loadavg.bin")
    if err != nil {
        t.Fatal(err)
    }
    
    var la loadavg
    err = binary.Read(newBytesReader(data), binary.LittleEndian, &la)
    // ... test parsing logic
}
```

## Why Fixtures?

1. **Cross-platform testing**: Test BSD syscall parsing on Linux/macOS
2. **Reproducible**: Same test data every run
3. **Fast**: No VM required for development testing
4. **Documented**: Known expected values for validation
5. **Regression protection**: Detects parsing changes

## Test Data Details

Current synthetic fixtures represent:
- **Load averages**: 3.24 (1min), 2.85 (5min), 2.12 (15min)
- **Adjusted load**: 5.24 (base load + 2 processes in page-fault wait)
- **Swap usage**: 37.5% total (Device 0: 25%, Device 1: 50%)
- **Process state**: 4 runnable, 1 disk wait, 2 page wait, 50 sleeping

See `system_info.txt` for complete details and metadata.
